<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Educational Calculator</title>
<style>
body { font-family:sans-serif; display:flex; justify-content:center; padding:20px; transition: background 0.3s, color 0.3s; }
body.light { background:#f5f5f5; color:#000; }
body.dark { background:#121212; color:#fff; }
body.rainbow { background:linear-gradient(135deg,#ff9a9e,#fad0c4,#a18cd1,#fbc2eb); color:#fff; }
.calc { padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.2); width:225px; transition: background 0.3s,color 0.3s; }
.calc.light { background:white; color:black; }
.calc.dark { background:#1e1e1e; color:white; }
.calc.rainbow { background:rgba(255,255,255,0.1); color:white; }
input { width:100%; height:30px; font-size:15px; text-align:right; padding:4px; margin-bottom:8px; border-radius:8px; border:1px solid #bbb; transition:background 0.3s,color 0.3s,border-color 0.3s; }
input.dark { background:#2b2b2b; color:white; border-color:#555; }
input.rainbow { background:rgba(255,255,255,0.2); color:white; border-color:#fff; }
button { width:40px; height:40px; font-size:15px; margin:3px; border-radius:8px; border:none; cursor:pointer; transition:transform 0.1s, background 0.3s, color 0.3s; }
button:active { transform:scale(1.1); }
.light button { background:#e0e0e0; color:#000; }
.dark button { background:#333; color:#fff; }
.rainbow button { background:linear-gradient(45deg,#ff9a9e,#fad0c4,#a18cd1,#fbc2eb); color:white; }
.row { display:flex; justify-content:space-between; }
.mode-switch button { width:100%; height:28px; font-size:14px; margin-bottom:8px; }
.history { max-height:80px; overflow-y:auto; background:rgba(0,0,0,0.05); padding:5px; margin-bottom:8px; border-radius:6px; font-size:12px; }
</style>
</head>
<body class="light">
<div class="calc light" id="calc">
  <div class="mode-switch">
    <button onclick="toggleMode()" id="modeButton">Switch to Dark Mode</button>
  </div>
  <div class="history" id="history"></div>

  <input id="display" readonly>

  <div class="row">
    <button onclick="memoryPlus()">M+</button>
    <button onclick="memoryMinus()">M-</button>
    <button onclick="memoryRecall()">MR</button>
    <button onclick="memoryClear()">MC</button>
    <button onclick="toggleFraction()">F/D</button>
  </div>

  <div class="row">
    <button onclick="press(Math.PI)">π</button>
    <button onclick="press(Math.E)">e</button>
    <button onclick="square()">x²</button>
    <button onclick="squareRoot()">√</button>
    <button onclick="percent()">%</button>
  </div>

  <div class="row">
    <button onclick="press('7')">7</button>
    <button onclick="press('8')">8</button>
    <button onclick="press('9')">9</button>
    <button onclick="press('/')">÷</button>
  </div>
  <div class="row">
    <button onclick="press('4')">4</button>
    <button onclick="press('5')">5</button>
    <button onclick="press('6')">6</button>
    <button onclick="press('*')">×</button>
  </div>
  <div class="row">
    <button onclick="press('1')">1</button>
    <button onclick="press('2')">2</button>
    <button onclick="press('3')">3</button>
    <button onclick="press('-')">−</button>
  </div>
  <div class="row">
    <button onclick="press('0')">0</button>
    <button onclick="press('.')">.</button>
    <button onclick="calculate()">=</button>
    <button onclick="press('+')">+</button>
  </div>

  <div class="row">
    <button style="width:100%" onclick="clearDisplay()">Clear</button>
  </div>
</div>
<script>
let mode='light';
let memory=0;
let historyList=[];
let lastResult = null;
let fractionMode = false;

function press(val){document.getElementById('display').value+=val;}
function clearDisplay(){document.getElementById('display').value='';}

function calculate(){
  try{
    let result=eval(document.getElementById('display').value);
    lastResult=result;
    fractionMode=false;
    document.getElementById('display').value=result;
    updateHistory(result);
    animateEqualizer();
  } catch { document.getElementById('display').value='Error'; }
}

function updateHistory(val){
  historyList.push(val);
  const historyDiv = document.getElementById('history');
  historyDiv.innerHTML = historyList.join('<br>');
  historyDiv.scrollTop = historyDiv.scrollHeight; // auto-scroll to bottom
}

function toggleMode(){
  const body=document.body, calc=document.getElementById('calc'), display=document.getElementById('display'), button=document.getElementById('modeButton');
  if(mode==='light'){
    mode='dark'; body.className='dark'; calc.className='calc dark'; display.className='dark'; button.innerText='Switch to Rainbow Mode';
  } else if(mode==='dark'){
    mode='rainbow'; body.className='rainbow'; calc.className='calc rainbow'; display.className='rainbow'; button.innerText='Switch to Light Mode';
  } else{
    mode='light'; body.className='light'; calc.className='calc light'; display.className=''; button.innerText='Switch to Dark Mode';
  }
}

function memoryPlus(){memory+=parseFloat(document.getElementById('display').value)||0;}
function memoryMinus(){memory-=parseFloat(document.getElementById('display').value)||0;}
function memoryRecall(){document.getElementById('display').value=memory;}
function memoryClear(){memory=0;}
function square(){document.getElementById('display').value=Math.pow(parseFloat(document.getElementById('display').value)||0,2);}
function squareRoot(){document.getElementById('display').value=Math.sqrt(parseFloat(document.getElementById('display').value)||0);}
function percent(){document.getElementById('display').value=(parseFloat(document.getElementById('display').value)||0)/100;}

function animateEqualizer(){const colors=['#ff4b5c','#ffb400','#6a0572','#009ffd'];const display=document.getElementById('display');display.style.background=colors[Math.floor(Math.random()*colors.length)];setTimeout(()=>{display.style.background='';},300);}

function toggleFraction(){
  if(lastResult === null) return;
  fractionMode = !fractionMode;
  if(fractionMode){ document.getElementById('display').value = decimalToFraction(lastResult); }
  else { document.getElementById('display').value = lastResult; }
}

function decimalToFraction(value, tolerance=1.0E-6){
  if(Number.isInteger(value)) return value.toString();
  let numerator=1, denominator=1;
  let fraction=numerator/denominator;
  while(Math.abs(fraction-value)>tolerance){
    if(fraction<value) numerator++;
    else denominator++;
    fraction=numerator/denominator;
  }
  return numerator+'/'+denominator;
}
</script>
</body>
</html>
